{"version":3,"sources":["img-crop.js"],"names":["Crop","options","element","document","querySelector","self","upload_btn","remove_btn","form","input","preview","preview_inner","img_el","crop_overlay","createElement","crop_area","left","top","width","height","choose_image","dispatchEvent","MouseEvent","view","window","bubbles","cancelable","show_preview","files","reader","FileReader","onload","e","style","display","src","target","result","classList","remove","children","add","readAsDataURL","_update_offset","remove_preview","type","addEventListener","appendChild","cur_side","click_down","el","index","Array","prototype","indexOf","call","parentElement","click_move","preventDefault","preview_offset","getBoundingClientRect","_top","pageY","clientHeight","_old_top","Math","round","_bottom","_left","pageX","clientWidth","_old_left","_right","_update_overlay","last_position","drag_crop_area","deltaX","clientX","x","deltaY","clientY","y","new_pos","Object","assign","_update_preview","method","body","JSON","stringify","headers","Headers","fetch","then","response","text","preview_img","base64_preview","throttle","callback","limit","wait","apply","setTimeout","bind_events","contains","removeEventListener","i","side"],"mappings":"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","file":"img-crop.js","sourcesContent":["function Crop(options) {\r\n\r\n    /* Get DOM node from selector */\r\n    this.element = document.querySelector(typeof options == 'object' ? options.element : options)\r\n    var self = this\r\n\r\n    /* Get all other elements */\r\n    let upload_btn = this.element.querySelector('.upload-btn')\r\n    let remove_btn = this.element.querySelector('.remove-btn')\r\n    let form = this.element.querySelector('form')\r\n    let input = form.querySelector('input[type=file].hidden')\r\n    let preview = this.element.querySelector('.crop-preview')\r\n    let preview_inner = preview.querySelector('.crop-inner')\r\n    let img_el = preview_inner.querySelector('img')\r\n    let crop_overlay = document.createElement('div')\r\n\r\n    /* Get preview if set */\r\n    if (options.preview) {\r\n        this.preview = document.querySelector(options.preview)\r\n    }\r\n\r\n    /* Debuggging... */\r\n    this.crop_area = {\r\n        left: 20,\r\n        top: 20,\r\n        width: 250,\r\n        height: 80\r\n    }\r\n    /* End debugging... */\r\n\r\n\r\n\r\n    /* Open file browser */\r\n    let choose_image = () => {\r\n        input.dispatchEvent(new MouseEvent('click', {\r\n            view: window,\r\n            bubbles: true,\r\n            cancelable: true\r\n        }))\r\n    }\r\n\r\n    /* SHOW image preview */\r\n    let show_preview = () => {\r\n        if (input.files && input.files[0]) {\r\n            let reader = new FileReader()\r\n            reader.onload = (e) => {\r\n                img_el.style.display = 'block'\r\n                img_el.src = e.target.result\r\n                preview.classList.remove('no-img')\r\n                preview.children[0].classList.add('hidden')\r\n            }\r\n            reader.readAsDataURL(input.files[0])\r\n        }\r\n        _update_offset()\r\n    }\r\n\r\n    /* REMOVE image preview */\r\n    let remove_preview = () => {\r\n        img_el.style.display = 'none'\r\n        preview.classList.add('no-img')\r\n        preview.children[0].classList.remove('hidden')\r\n        input.remove()\r\n        input = document.createElement('input')\r\n        input.type = 'file'\r\n        input.classList.add('hidden')\r\n        input.addEventListener('change', show_preview, false)\r\n        this.element.querySelector('form').appendChild(input)\r\n    }\r\n\r\n    var cur_side\r\n    let click_down = e => {\r\n        cur_side = {\r\n            el: e.target,\r\n            index: Array.prototype.indexOf.call(e.target.parentElement.children, e.target) + 1\r\n        }\r\n        document.addEventListener('mousemove', click_move, false)\r\n        e.preventDefault()\r\n        return false\r\n    }\r\n\r\n    var preview_offset,\r\n        _update_offset = () => {\r\n            preview_offset = preview_inner.getBoundingClientRect()\r\n        }\r\n    function click_move(e) {\r\n        if (cur_side.index == 1) {\r\n            // Top\r\n            let _top = e.pageY - preview_offset.top\r\n            if (_top < preview_inner.clientHeight && _top > 0) {\r\n                let _old_top = self.crop_area.top\r\n                self.crop_area.top = Math.round(_top)\r\n                self.crop_area.height -= self.crop_area.top - _old_top\r\n            }\r\n        } else if (cur_side.index == 3) {\r\n            // Bottom\r\n            let _bottom = (preview_offset.top + preview_inner.clientHeight) - e.pageY\r\n            if (_bottom < preview_inner.clientHeight - self.crop_area.top && _bottom > 0) {\r\n                self.crop_area.height = Math.round(preview_inner.clientHeight - self.crop_area.top - _bottom)\r\n            }\r\n        } else if (cur_side.index == 4) {\r\n            // Left\r\n            let _left = e.pageX - preview_offset.left\r\n            if (_left < preview_inner.clientWidth && _left > 0) {\r\n                let _old_left = self.crop_area.left\r\n                self.crop_area.left = Math.round(_left)\r\n                self.crop_area.width -= self.crop_area.left - _old_left\r\n            }\r\n        } else {\r\n            // Right\r\n            let _right = (preview_offset.left + preview_inner.clientWidth) - e.pageX\r\n            if (_right < preview_inner.clientWidth - self.crop_area.left && _right > 0) {\r\n                self.crop_area.width = Math.round(preview_inner.clientWidth - self.crop_area.left - _right)\r\n            }\r\n        }\r\n        _update_overlay()\r\n    }\r\n\r\n    var last_position\r\n    function drag_crop_area(e) {\r\n        if (last_position) {\r\n            /* Get new crop position */\r\n            let deltaX = e.clientX - last_position.x,\r\n                deltaY = e.clientY - last_position.y,\r\n                new_pos = {\r\n                    left: self.crop_area.left + deltaX < 0 ? 0 : self.crop_area.left + deltaX,\r\n                    top: self.crop_area.top + deltaY < 0 ? 0 : self.crop_area.top + deltaY\r\n                }\r\n\r\n            /* Restrict to inside crop area */\r\n            if (new_pos.left >= preview_inner.clientWidth - self.crop_area.width) new_pos.left = self.crop_area.left\r\n            if (new_pos.top >= preview_inner.clientHeight - self.crop_area.height) new_pos.top = self.crop_area.top\r\n\r\n            /* Update overlay then render */\r\n            self.crop_area = Object.assign(self.crop_area, new_pos)\r\n            _update_overlay()\r\n        }\r\n        last_position = {\r\n            x: e.clientX,\r\n            y: e.clientY\r\n        }\r\n    }\r\n\r\n    function _update_overlay() {\r\n        crop_overlay.style.left = self.crop_area.left + 'px'\r\n        crop_overlay.style.top = self.crop_area.top + 'px'\r\n        crop_overlay.style.width = self.crop_area.width + 'px'\r\n        crop_overlay.style.height = self.crop_area.height + 'px'\r\n    }\r\n\r\n    /* Fetch cropped image preview from server */\r\n    function _update_preview() {\r\n        let options = {\r\n            method: 'POST',\r\n            body: JSON.stringify(self.crop_area),\r\n            headers: new Headers({\r\n                'Content-Type': 'application/json'\r\n            })\r\n        }\r\n        fetch('/preview', options)\r\n            .then(response => {\r\n                return response.text()\r\n            })\r\n            .then(base64_preview => {\r\n                if (!self.preview_img) {\r\n                    self.preview_img = document.createElement('img')\r\n                    self.preview.appendChild(self.preview_img)\r\n                }\r\n                self.preview_img.src = 'data:image/jpeg;base64,' + base64_preview\r\n            })\r\n    }\r\n\r\n    /* Limit calls to a function */\r\n    function throttle(callback, limit) {\r\n        let wait = false\r\n        return () => {\r\n            if (!wait) {\r\n                callback.apply(null, arguments)\r\n                wait = true\r\n                setTimeout(() => {\r\n                    wait = false\r\n                }, limit)\r\n            }\r\n        }\r\n    }\r\n\r\n    /* Bind events */\r\n    function bind_events() {\r\n        upload_btn.addEventListener('click', choose_image, false)\r\n        remove_btn.addEventListener('click', remove_preview, false)\r\n        input.addEventListener('change', show_preview, false)\r\n        crop_overlay.addEventListener('mousedown', (e) => {\r\n            if (e.target.classList.contains('side')) return\r\n            document.addEventListener('mousemove', drag_crop_area, false)\r\n        }, false)\r\n        document.addEventListener('mouseup', () => {\r\n            last_position = null\r\n            document.removeEventListener('mousemove', click_move, false)\r\n            document.removeEventListener('mousemove', drag_crop_area, false)\r\n            _update_preview()\r\n        }, false)\r\n        window.addEventListener('resize', throttle(() => {\r\n            _update_offset()\r\n            _update_overlay()\r\n            last_position = null\r\n        }, 50), false)\r\n    }\r\n\r\n\r\n\r\n    /* Initialise preview */\r\n    (() => {\r\n        for (let i = 4; i > 0; i--) {\r\n            let side = document.createElement('div')\r\n            side.classList.add('side')\r\n            side.addEventListener('mousedown', click_down, false)\r\n            crop_overlay.appendChild(side)\r\n        }\r\n        crop_overlay.classList.add('crop-overlay')\r\n\r\n        preview_inner.appendChild(crop_overlay)\r\n        if (!img_el) {\r\n            img_el = document.createElement('img')\r\n            preview_inner.appendChild(img_el)\r\n        } else {\r\n            img_el.addEventListener('load', _update_offset)\r\n            img_el.addEventListener('load', _update_overlay)\r\n            img_el.addEventListener('load', _update_preview)\r\n        }\r\n\r\n        bind_events()\r\n    })()\r\n\r\n    this.choose_image = choose_image\r\n\r\n    return this\r\n\r\n}\r\n"]}